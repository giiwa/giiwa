window.giiwa={};giiwa.extend=function(a){for(var b in a){giiwa[b]=a[b];}};giiwa.extend({__history:[],uploaddone:false,_popup:false,loadimage:function(c,b){if(c&&c!=""){var a=new Image();a.onload=function(){b&&b(c);};a.src=c;}},popover:function(d,b,c){var a=$("#popover");if(a.length==0){a=$("<div id='popover'><span class='top'></span><span class='right'></span><span  class='bottom'></span><span class='left'></span><div class='cc'></div></div>");$("body").append(a);}d.each(function(f,g){g=$(g);g.on("mouseover",function(e){a.find(">span").hide();var j=b.clone();c&&c.onprepare&&c.onprepare(g,j);j.show();var k=a.find(">.cc");k.empty();k.append(j);var h=g.attr("data-hint");if(h=="top"){a.find(">span.bottom").show();a.css("top",(g.offset().top-a.height()-21)+"px");a.css("left",(g.offset().left+g.width()/2-a.width()/2)+"px");}else{if(h=="right"){a.find(">span.left").show();a.css("top",(g.offset().top+g.height()/2-a.height()/2)+"px");a.css("left",(g.offset().left+g.width()+21)+"px");}else{if(h=="left"){a.find(">span.right").show();a.css("top",(g.offset().top+g.height()/2-a.height()/2)+"px");a.css("left",(g.offset().left-a.width()-21)+"px");}else{a.find(">span.top").show();a.css("top",(g.offset().top+g.height()+21)+"px");a.css("left",(g.offset().left+g.width()/2-a.width()/2)+"px");}}}a.show();}).on("mouseout",function(h){a.hide();});});},upload:function(files,opt){opt=$.extend({chunksize:1024*1024},opt);$(files).each(function(i,file){var lastmodified=file.lastModified;var name=file.name;var size=file.size;var pos=0;var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(e){if(xhr.readyState==4){e=eval("("+xhr.response+")");opt.onprogress&&opt.onprogress(e);pos=e.pos;if(pos<size){_next();}else{opt.ondone&&opt.ondone(e);}}};xhr.onerror=function(e){console.log(xhr);};var _upload=function(bb){xhr.open("POST",opt.url,true);xhr.setRequestHeader("lastModified",file.lastModified);xhr.setRequestHeader("Content-Range","bytes "+pos+"-"+(pos+opt.chunksize+1)+"/"+file.size);var data=new FormData();data.append("filename",name);data.append("file",bb);xhr.send(data);};var _next=function(){var bb=false;if(file.webkitSlice){bb=file.webkitSlice(pos,pos+opt.chunksize+1);}else{if(file.mozSlice){bb=file.mozSlice(pos,pos+opt.chunksize+1);}else{if(file.slice){bb=file.slice(pos,pos+opt.chunksize+1);}}}if(bb){_upload(bb);}else{_upload(file);}};opt.onstart&&opt.onstart({name:name,pos:pos});_next();});},size:function(b){var a="";if(b<1024){}else{if(b<1024*1024){a="k";b/=1024;}else{if(b<1024*1024*1024){a="M";b/=1024*1024;}else{a="G";b/=1024*1024*1024;}}}return(parseInt(b)*10/10)+a;},link:function(f,a){f=$(f);var d=f.attr("target");if(d&&d.length>0){return;}var b=f.attr("onclick");if(b&&b.length>0){return;}var c=f.attr("href");if(!c){return;}if(c.indexOf("javascript")!=0&&c.indexOf("#")!=0){f.click(function(e){if(e.done!=1){c=f.attr("href");a&&a(c);e.done=1;e.preventDefault();e.stopPropagation();}});}},call:function(a,b){setTimeout(function(){a();},b);},portlet:function(b,a){b.find(".portlet").each(function(d,j){var c=$(j);c.bind("reload",function(){c.attr("data-loaded","0");f();});f();function f(){if(c.attr("data-loaded")!="1"){var e=c.attr("data-url");if(e&&e.length>0){h(e);}}}function h(e){$.get(e,function(k){c.attr("data-loaded","1");if(k.length>0){c.html(k);c.fadeIn();g(c);a&&a(c);}});}function g(e){e.find("a").each(function(l,k){giiwa.link(k,function(m){h(m);});});}});},initmenu:function(f,c){c=$.extend({root:0,name:"home"},c);var e=f;$.post(c.url,{root:c.root,name:c.name},function(h){var g="";$(h).each(function(j,k){g+=d(k);});e.html(g);b(e);giiwa.resize();});function d(h){var g='<div class="';if(h.hasChildren||h.click||h.url||h.load){g+="item";}g+='"';if(h.style){g+=' style="'+h.style+'" ';}g+=">";g+='<div class="title ';if(h.hasChildren){g+=" haschild ";}g+='" mid="'+h.id+'" ';g+=' seq="'+h.seq+'" ';if(h.load){g+=" data-load='"+h.load+"' ";}else{if(h.click){g+=' onclick=\'$("#menu .menu .selected").removeClass("selected");$(this).addClass("selected");'+h.click+"' ";}}if(h.tag){g+=' tag="'+h.tag+'" ';}g+=' data-title="'+h.text+'"> ';g+='<i class="icon ';if(h.classes){g+=h.classes;}g+='"></i>';if(h.url){g+='&nbsp;<span><a href="'+h.url+'" target="_blank">'+h.text+"</a></span>";}else{g+="&nbsp;<span>"+h.text+"</span>";}if(h.hasChildren){g+='<i class="arrow"></i>';}g+="</div>";if(h.hasChildren){g+='<div class="children"></div>';}g+="</div>";return g;}function b(h){var g=h.find("div.title");g.bind("click",function(){var j=$(this);if(j.attr("data-load")){f.find(".selected").removeClass("selected");j.addClass("selected");giiwa.load(j.attr("data-load"));}if(j.hasClass("haschild")){a(this);}});g.bind("mouseenter",function(){$(this).addClass("hover");});g.bind("mouseleave",function(){$(this).removeClass("hover");});}function a(h){h=$(h);var g=h.parent();if(h.hasClass("open")){h.removeClass("open");$(g.find(".children")[0]).slideUp(500,function(){giiwa.resize();});}else{h.addClass("open");var j=g.find(".children .item");if(j.length==0){g.addClass("loading");$.post(c.url,{root:h.attr("mid")},function(m){var k="";$(m).each(function(n,o){k+=d(o);});var l=g.find(".children");l.html(k);if(h.attr("title")&&h.attr("title")!=""){l.find(".item .title").each(function(n,o){o=$(o);o.attr("title",o.attr("data-title"));});}b(l);$(g.find(".children")[0]).slideDown(500,"easeOutQuad",function(){g.removeClass("loading");giiwa.resize();});});}else{$(g.find(".children")[0]).slideDown(500,"easeOutQuad",function(){giiwa.resize();});}}}},popupmenu:function(f,d,a){var c=$("#popupmenu");if(c.length==0){c=$("<div id='popupmenu'><div class='bg'></div><div class='menu'></div></div>");$("body").append(c);}c.find(".bg").on("click",function(g){c.hide();});var e=c.find(">.menu");e.empty();var b=f.clone();e.append(b);e.css("left",d[0]+"px");e.css("top",d[1]+"px");b.show();c.find(".menuitem").on("click",function(){var g=this;if($(g).hasClass("disabled")){return;}c.hide();setTimeout(function(){a(g);},100);});c.show();},submit:function(d,c){var j=$(d).find("input[required=true], select[required=true]");for(i=0;i<j.length;i++){var g=$(j[i]);if(g.val()==""){g.focus();return;}}var b=d.action;if(d!=undefined&&b!=undefined){giiwa.processing.show();if(d.method=="get"){var f=$(d).serialize();var a="";if(b.indexOf("?")>0){a=b+"&"+f;}else{a=b+"?"+f;}giiwa.history(a);$.get(a,{},function(e){giiwa.processing.hide();c&&c.success&&c.success(e,"get");});}else{var f=new FormData(d);var h=new XMLHttpRequest();h.open("POST",b);h.overrideMimeType("multipart/form-data");h.send(f);h.onreadystatechange=function(){if(h.readyState==4){if(h.status==200){giiwa.processing.hide();c&&c.success&&c.success(h.responseText,"post");}}};}}},dialog:function(b,c){if(!b||b.length==0){return giiwa._dialog;}c=$.extend({width:400,height:200,z:10001,moveable:true},c);var e=$("#dialog");if(e.length==0){e=$('<div id="dialog"><div class="dialogbg"></div><div class="dialog"><a class="close">X</a><div class="scroll"></div></div></div>');$("body").append(e);if(c&&c.moveable){$("#dialog .dialog").draggable();}$("#dialog .dialogbg, #dialog a.close").click(function(g){e.fadeOut(100,function(){e.remove();});});}else{if(giiwa._dialog){giiwa._dialog.remove();}}e.css("z-index",c.z);var f=$("#dialog .dialog");f.css("width",c.width+"px");f.css("height",c.height+"px");f.css("left","calc(50% - "+c.width/2+"px)");f.css("top","calc(50% - "+c.height/2+"px");var a=$("#dialog .dialog>.scroll");a.empty();var d=b.clone();a.append(d);d.css("display","inline-block");c&&c.prepare&&c.prepare(d);d.find("form").submit(function(h){h.preventDefault();var g=h.target;giiwa.submit(g,{success:function(j){e.fadeOut(100,function(){e.remove();c.onclose&&c.onclose("success");});c.onsubmit&&c.onsubmit(j);}});});e.fadeIn(100);giiwa._dialog={panel:d,close:function(){e.fadeOut(100,function(){e.remove();});},remove:function(){}};return giiwa._dialog;},popup:function(b,c){if(!b){return giiwa._popup;}c=$.extend({max:true,close:true,z:10000,width:"70%",height:"70%",moveable:false},c);var d=$("#gwpopup");if(d.length==0){d=$('<div id="gwpopup"><div class="popupbg"></div><div class="popup"><a class="prev">&lt;</a><a class="max"><i class="icon-checkbox-unchecked"></i></a><a class="close">X</a><div class="scroll"><img src="/images/loading2.gif"></div></div></div>');$("body").append(d);$("#gwpopup>.popup").draggable();$("#gwpopup .popupbg, #gwpopup a.close").click(function(g){try{c.beforeclose&&c.beforeclose("close");}catch(f){console.error(f);}d.fadeOut(100,function(){d.remove();c.onclose&&c.onclose("close");});});$("#gwpopup a.max").click(function(g){$("#gwpopup .popup").toggleClass("max");try{c.beforeclose&&c.beforeclose("max");}catch(f){console.error(f);}giiwa._popup.reload();});$("#gwpopup a.prev").click(function(j){if(giiwa.popuphistory&&giiwa.popuphistory.length>1){var f=giiwa.popuphistory.pop();f=giiwa.popuphistory.pop();try{c.beforeclose&&c.beforeclose("back");}catch(g){console.error(g);}giiwa.popup(f);}});giiwa.popuphistory=[];}else{d.find("div.scroll").html('<img src="/images/loading2.gif">');}d.css("z-index",c.z);if(giiwa.popuphistory&&giiwa.popuphistory.length>0){d.find("a.prev").show();}else{d.find("a.prev").hide();}if(giiwa.popuphistory.length==0||b!=giiwa.popuphistory[giiwa.popuphistory.length-1]){giiwa.popuphistory.push(b);}if(c.max){$("#gwpopup a.max").show();}else{$("#gwpopup a.max").hide();}var e=$("#gwpopup>.popup");if(!isNaN(c.width)){e.css("width",c.width+"px");e.css("left","calc(50% - "+(c.width/2)+"px)");}else{e.css("width",c.width);e.css("left",c.left);}if(!isNaN(c.height)){e.css("height",c.height+"px");e.css("top","calc(50% - "+(c.height/2)+"px");}else{e.css("height",c.height);e.css("top",c.top);}var a=$("#gwpopup>.popup>.scroll");giiwa.processing.show();$.get(b,function(g){giiwa.processing.hide();a.html(g);f(a);function f(h){h.find("a").each(function(j,k){giiwa.link(k,function(l){giiwa.popup(l,c);});});h.find("form").submit(function(k){k.preventDefault();var j=k.target;giiwa.submit(j,{success:function(l){if(c.onsubmit){c.onsubmit(l);}else{d.fadeOut(100,function(){d.remove();c.onclose&&c.onclose("success");});}}});});giiwa.portlet(h,function(j){});}});d.fadeIn(100);giiwa._popup={close:function(f){giiwa.popuphistory=[];if(d&&d.length>0&&d.css("display")!="none"){try{c.beforeclose&&c.beforeclose(f);}catch(g){console.error(g);}d.fadeOut(100,function(){d.remove();c.onclose&&c.onclose(f);});}},data:function(f){c.ondata&&c.ondata(f);},isShowing:function(){return d&&d.length>0&&d.css("display")!="none";},reload:function(){try{c.beforeclose&&c.beforeclose("reload");}catch(g){console.error(g);}var f=giiwa.popuphistory.pop();giiwa.popup(f,c);},back:function(){var f=giiwa.popuphistory.pop();var f=giiwa.popuphistory.pop();try{c.beforeclose&&c.beforeclose("back");}catch(g){console.error(g);}giiwa.popup(f,c);},moveable:function(f){if(f){$("#gwpopup>.popup").draggable("enable");}else{$("#gwpopup>.popup").draggable("disable");}}};giiwa._popup.opt=c;giiwa._popup.moveable(c&&c.moveable);return giiwa._popup;},download:function(a){var b=$("a#download");if(b.length==0){b=$("<a id='download' download hidden></a>");$("body").append(b);}b.attr("href",a);b[0].click();},open:function(a){var b=$("a#open");if(b.length==0){b=$("<a id='open' style='display:none' target='_blank'></a>");$("body").append(b);}b.attr("href",a);b[0].click();},processing:{show:function(){var a=$("#processing");if(a.length==0){a=$('<div id="processing" class="k-loader"><div class="bg"></div><div class="k-loader1"><span class="k-loader-segment"></span><span class="k-loader-segment"></span><span class="k-loader-segment"></span><span class="k-loader-segment"></span></div><p></p></div>');$("body").append(a);}a.show();},hide:function(){$("#processing p").html("");$("#processing").hide();},message:function(a){$("#processing p").html(a);}},css:function(c){if(c&&c.length>0){var a=c.split(",");var b=$(document).find("link");$(a).each(function(d,e){e=e.trim();for(var d=0;d<b.length;d++){if(b[d].href&&b[d].href.indexOf(e)>=0){return;}}$("head").append('<link href="'+e+'" rel="stylesheet" />');});}},js:function(c){if(c&&c.length>0){var a=c.split(",");var b=$(document).find("script");$(a).each(function(d,e){e=e.trim();for(var d=0;d<b.length;d++){if(b[d].src&&b[d].src.indexOf(e)>=0){return;}}$("body").append('<script type="text/javascript" src="'+e+'"><\/script>');});}},history:function(a){if(a!==undefined&&a.length>0){var b=giiwa.__history.pop();if(b!==undefined){giiwa.__history.push(b);}if(b===undefined||b!=a){giiwa.__history.push(a);}while(giiwa.__history.length>100){giiwa.__history.shift();}}},back:function(){if(giiwa.__history.length>1){var a=giiwa.__history.pop();a=giiwa.__history.pop();giiwa.load(a);}},show:function(a){giiwa.uploaddone=false;try{$("#panel").trigger("beforechange");}catch(c){console.error(c);}try{$("#panel .content").html(a);}catch(b){console.error(b);}giiwa.hook($("#panel .content"));},hook:function(panel){giiwa.portlet(panel,function(e){giiwa.hook(e);});panel.find("a").each(function(i,e){giiwa.link(e,function(url){giiwa.load(url);});});panel.find("form").submit(function(e){e.preventDefault();var form=e.target;giiwa.submit(form,{success:function(d,method){if(method=="post"){try{d=eval("("+d+")");}catch(e){console.error(e);}if(d.state==200){giiwa.back();giiwa.hint(d.message);}else{if(d.message){giiwa.error(d.message);}}}else{giiwa.show(d);}}});});panel.find("table th.checkbox").click(function(e){var ch=$(this).find("input[type=checkbox]");if(ch.length>0){var en=ch[0].checked;var t=$(this);while(t.length>0&&t[0].nodeName!=="TABLE"){t=t.parent();}t.find("td input[type=checkbox]").each(function(i,e){if(!e.disabled){e.checked=en;}});}});var options=options||{};panel.find("select[parentnode=true]").change(function(e){var ch=$(this);if(ch.length>0){var value=ch.val();var subnode=ch.attr("subnode");var n1=$("select[name="+subnode+"]");if(options[ch.attr("name")]){n1.html(options[ch.attr("name")]);}else{options[ch.attr("name")]=n1.find("option");}var valid=false;var best=undefined;n1.find("option").each(function(i,e){e=$(e);if(e.attr("parent")==value||e.attr("parent")==undefined){e.show();if(best===undefined){best=e.val();}if(!valid&&e.val()==n1.val()){valid=true;}}else{e.remove();}});if(!valid){n1.val(best);n1.trigger("change");}}});panel.find("select").each(function(i,e){if(e.value==""){$(e).removeClass("setted");}else{$(e).addClass("setted");}}).change(function(e){if(this.value==""){$(this).removeClass("setted");}else{$(this).addClass("setted");}});panel.find("table.tablesorter tr").bind("mouseenter",function(){var e=$(this);while(e.hasClass("link")){e=e.prev();}e.addClass("hover");e=e.next();while(e.hasClass("link")){e.addClass("hover");e=e.next();}}).bind("mouseleave",function(){var e=$(this);while(e.hasClass("link")){e=e.prev();}e.removeClass("hover");e=e.next();while(e.hasClass("link")){e.removeClass("hover");e=e.next();}});panel.find("table.tablesorter td").bind("mouseenter",function(){$(this).addClass("hover");}).bind("mouseleave",function(){$(this).removeClass("hover");});panel.find("div.search").searchbar();panel.find("input").bind("focus",function(){$(this).parent().addClass("focus");}).bind("blur",function(){var that=$(this);that.parent().removeClass("focus");if(that.attr("verify")){}if(that.attr("max")){var value=that.val();}});setTimeout(function(){panel.find(".blink").each(function(i,e){$(e).removeClass("blink");});},100);},reload:function(a){if(giiwa.__history.length>1){giiwa.load(giiwa.__history.pop(),a);return true;}return false;},load:function(b,a){if(!b){return;}giiwa.history(b);giiwa.processing.show();giiwa.popup()&&giiwa.popup().close();giiwa.dialog()&&giiwa.dialog().close();$.ajax({url:b,type:"GET",data:{},error:function(c){giiwa.processing.hide();window.location.href="/";},success:function(g,c,f){giiwa.processing.hide();var e={status:f.getResponseHeader("status")};if(e.status=="401"){window.location.href="/";}else{if(a){a(g);}else{giiwa.show(g);}}}});},load1:function(b){giiwa.processing.show();var a='<iframe src="'+b+'"></iframe>';giiwa.processing.hide();giiwa.show(a);},_post:function(g,e,a){var d="";var b="";var c=$(e+" td input:checked");if(c.length==0){return;}c.each(function(h,j){if(d.length>0){d+=",";}d+=j.value;b=j.name;});var f={};f[b]=d;$.get(g,f,function(h){giiwa.show(h);});},resize:function(d){var c=$(window).height();var b=$(window).width();var g=$("#menu");var a=$("#panel");if(a.length>0&&((a.width()!=b-a.offset().left)||(a.height()!=c-92))){a.css("width",(b-a.offset().left)+"px");a.css("height",(c-92)+"px");try{a.trigger("panelresize",a);}catch(f){console.error(f);}}if(g.length>0){g.css("height",(c-92)+"px");}},verify:function(c,a){var b=$(c);$.post(a,{name:b.attr("name"),value:b.val()},function(f){if(f.state==200){b.attr("bad","0");if(f.value){b.val(f.value);}b.removeClass("bad").addClass("good");b.parent().parent().find(".note").hide();}else{if(f.state==400){if(confirm(f.message)){b.attr("bad","0");if(f.value){b.val(f.value);}b.removeClass("bad").addClass("good");b.parent().parent().find(".note").hide();}else{b.attr("bad","1");b.removeClass("good").addClass("bad");var e=b.parent().parent().find(".note");if(e.length==0){e=$('<div class="note"></div>');b.parent().parent().append(e);}e.html(f.error).show();}}else{b.attr("bad","1");b.removeClass("good").addClass("bad");var e=b.parent().parent().find(".note");if(e.length==0){e=$('<div class="note"></div>');b.parent().parent().append(e);}e.html(f.message).show();}}});},message:function(c,b){var a=$("#leanmodal");if(a.length==0){a=$("<div id='leanmodal' class='hint'><div class='bg'></div><div class='leanmodal-content'></div></div>");$("body").append(a);}a.attr("class","message");a.find(".leanmodal-content").html(c);a.css({display:"block"});a.click(function(){a.hide();});a.click(function(){a.hide();b&&b();});},hint:function(c,b){if(!b){b=2000;}var a=$("#leanmodal");if(a.length==0){a=$("<div id='leanmodal' class='hint'><div class='bg'></div><div class='leanmodal-content'></div></div>");$("body").append(a);}a.attr("class","hint");a.find(".leanmodal-content").html(c);a.css({display:"block"});a.click(function(){a.hide();});setTimeout(function(){a.fadeOut(100);},b);},warn:function(c,b){var a=$("#leanmodal");if(a.length==0){a=$("<div id='leanmodal' class='hint'><div class='bg'></div><div class='leanmodal-content'></div></div>");$("body").append(a);}a.attr("class","warn");a.find(".leanmodal-content").html(c);a.css({display:"block"});a.click(function(){a.hide();b&&b();});},error:function(c,b){var a=$("#leanmodal");if(a.length==0){a=$("<div id='leanmodal' class='hint'><div class='bg'></div><div class='leanmodal-content'></div></div>");$("body").append(a);}a.attr("class","error");a.find(".leanmodal-content").html(c);a.css({display:"block"});a.click(function(){a.hide();b&&b();});},fullscreen:function(a){if(a.requestFullscreen){a.requestFullscreen();}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen();}else{if(a.webkitRequestFullscreen){a.webkitRequestFullscreen();}else{if(element.msRequestFullscreen){a.msRequestFullscreen();}}}}},encode:function(a){return btoa(a);},decode:function(a){return atob(a);}});$(function(){$(window).resize(function(){giiwa.resize();});});